import{d as T,q as p,s as y,w as I,c as d,n as B,b as t,t as l,a as c,B as _,P as V,h as U,l as $,r as z,U as b,e as m,M as D,o as a,R as H,_ as E,k as M,F as P,V as O,g as F}from"./index-DeuHV4uV.js";import{R as N}from"./ServerSettingsStore-Brd5keeW.js";import{V as q}from"./VSwitch-EvGbZM2C.js";import{c as j}from"./VChip-DbrXwLG0.js";import{R as A}from"./ReservationDetailDrawer-DLps0eQs.js";import{V as G}from"./VSelect-DaCxzYjV.js";import{V as J}from"./VPagination-C6do8RZo.js";const K={class:"reservation__container"},Q={class:"reservation__controls"},W={class:"reservation__priority"},X={class:"reservation__priority-badge"},Y={class:"reservation__toggle-label"},Z={key:1,class:"reservation__recording"},x={class:"reservation__content"},ee={class:"reservation__content-header"},te=["innerHTML"],se={class:"reservation__content-status"},oe={class:"reservation__content-meta"},re={class:"reservation__content-meta-broadcaster"},ae=["src"],ne={class:"reservation__content-meta-broadcaster-name"},ie={class:"reservation__content-meta-time"},le={class:"reservation__content-meta-size-comment"},de={key:0,class:"reservation__content-meta-comment"},ce={class:"reservation__content-meta-comment-text"},ve={class:"reservation__content-meta-size"},ue={class:"reservation__content-meta-time-pc"},_e={class:"reservation__content-description-container"},me=["innerHTML"],pe={class:"reservation__content-description-size-pc"},ge=T({__name:"Reservation",props:{reservation:{}},emits:["deleted","click"],setup(C,{emit:R}){const o=C,h=R,n=p(o.reservation.record_settings.is_enabled),v=p(!1);y(()=>o.reservation.record_settings.is_enabled,e=>{n.value=e});const u=e=>{const s=e.target;s.src=`${b.api_base_url}/channels/gr001/logo`},g=e=>{if(e.is_recording_in_progress)return"録画中";switch(e.recording_availability){case"Full":return"録画可能";case"Partial":return"一部のみ録画可能";case"Unavailable":return"チューナー不足";default:return"不明"}},f=e=>{if(e.is_recording_in_progress)return"fluent:record-16-filled";switch(e.recording_availability){case"Full":return"fluent:checkmark-16-filled";case"Partial":return"fluent:warning-16-filled";case"Unavailable":return"fluent:dismiss-circle-16-filled";default:return"fluent:question-circle-16-filled"}},L=e=>{if(e.is_recording_in_progress)return"primary";switch(e.recording_availability){case"Full":return"success";case"Partial":return"warning";case"Unavailable":return"error";default:return"grey"}},S=()=>{h("click",o.reservation)},k=async()=>{if(!v.value){v.value=!0;try{const e={...o.reservation.record_settings,is_enabled:n.value};if(await N.updateReservation(o.reservation.id,e)){const i=n.value?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;D.success(i)}else n.value=o.reservation.record_settings.is_enabled}catch(e){console.error("Failed to update reservation:",e),n.value=o.reservation.record_settings.is_enabled}finally{v.value=!1}}},w=e=>{e.stopPropagation()};return(e,s)=>{const i=z("Icon");return I((a(),d("div",{class:B(["reservation",{"reservation--disabled":!n.value}]),onClick:S},[t("div",K,[t("div",Q,[t("div",W,[t("div",X,l(e.reservation.record_settings.priority),1),s[1]||(s[1]=t("div",{class:"reservation__priority-label"},"優先度",-1))]),e.reservation.is_recording_in_progress?(a(),d("div",Z,s[2]||(s[2]=[t("div",{class:"reservation__recording-icon"},null,-1)]))):(a(),d("div",{key:0,class:"reservation__toggle",onClick:w},[c(q,{modelValue:n.value,"onUpdate:modelValue":[s[0]||(s[0]=r=>n.value=r),k],color:"primary",density:"compact","hide-details":"",onClick:w},null,8,["modelValue"]),t("div",Y,l(n.value?"有効":"無効"),1)]))]),t("div",x,[t("div",ee,[t("div",{class:"reservation__content-title",innerHTML:_(V).decorateProgramInfo(e.reservation.program,"title")},null,8,te),t("div",se,[c(j,{color:L(e.reservation),size:"small",variant:"tonal"},{default:U(()=>[c(i,{icon:f(e.reservation),width:"12px",height:"12px",class:"mr-1"},null,8,["icon"]),$(" "+l(g(e.reservation)),1)]),_:1},8,["color"])])]),t("div",oe,[t("div",re,[t("img",{class:"reservation__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${_(b).api_base_url}/channels/${e.reservation.channel.id}/logo`,onError:u},null,40,ae),t("span",ne,"Ch: "+l(e.reservation.channel.channel_number)+" "+l(e.reservation.channel.name),1)]),t("div",ie,l(_(V).getProgramTime(e.reservation.program)),1),t("div",le,[e.reservation.comment?(a(),d("div",de,[c(i,{icon:"fluent:note-20-filled",width:"14px",height:"14px",class:"reservation__content-meta-comment-icon"}),t("span",ce,l(e.reservation.comment),1)])):m("",!0),t("div",ve,[c(i,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"reservation__content-meta-size-icon"}),$(" 約 "+l(_(b).formatBytes(e.reservation.estimated_recording_file_size,1,!0)),1)])]),t("div",ue,l(_(V).getProgramTime(e.reservation.program)),1)]),t("div",_e,[t("div",{class:"reservation__content-description",innerHTML:_(V).decorateProgramInfo(e.reservation.program,"description")},null,8,me),t("div",pe,[c(i,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"reservation__content-description-size-icon"}),$(" 約 "+l(_(b).formatBytes(e.reservation.estimated_recording_file_size,1,!0)),1)])])])])],2)),[[H]])}}}),he=E(ge,[["__scopeId","data-v-40295b41"]]),fe={key:0,class:"reservation-list__header"},ye={class:"reservation-list__title"},be={class:"reservation-list__title-text"},ke={key:1,class:"reservation-list__title-count"},we={class:"reservation-list__actions"},Ve={class:"reservation-list__empty-content"},Me=["innerHTML"],Be=["innerHTML"],$e={class:"reservation-list__grid-content"},Ce={key:1,class:"reservation-list__pagination"},Re=T({__name:"ReservationList",props:{title:{},reservations:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:timer-20-regular"},emptyMessage:{default:"まだ録画予約がありません。"},emptySubMessage:{default:"番組表から録画予約を追加できます。"},isLoading:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more","delete"],setup(C,{emit:R}){const o=C,h=p(o.page),n=p(o.sortOrder),v=p([...o.reservations]),u=p(o.total),g=p(!1),f=p(null);y(()=>o.page,e=>{h.value=e}),y(()=>o.sortOrder,e=>{n.value=e}),y(()=>o.reservations,e=>{v.value=[...e]}),y(()=>o.total,e=>{u.value=e});const L=R,S=e=>{f.value=e,g.value=!0},k=e=>{v.value=v.value.filter(s=>s.id!==e),u.value=Math.max(0,u.value-1),g.value=!1,L("delete",e)},w=e=>{const s=v.value.findIndex(i=>i.id===e.id);s!==-1&&(v.value[s]=e),f.value=e};return(e,s)=>{const i=z("Icon");return a(),d("div",{class:B(["reservation-list",{"reservation-list--show-sort":!e.hideSort}])},[e.hideHeader?m("",!0):(a(),d("div",fe,[t("h2",ye,[e.showBackButton?I((a(),d("div",{key:0,class:"reservation-list__title-back",onClick:s[0]||(s[0]=r=>e.$router.back())},[c(i,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[H]]):m("",!0),t("span",be,l(e.title),1),e.showMoreButton?m("",!0):(a(),d("div",ke,[e.isLoading?(a(),M(i,{key:0,icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"})):(a(),d(P,{key:1},[$(l(u.value)+"件",1)],64))]))]),t("div",we,[e.hideSort?m("",!0):(a(),M(G,{key:0,modelValue:n.value,"onUpdate:modelValue":[s[1]||(s[1]=r=>n.value=r),s[2]||(s[2]=r=>e.$emit("update:sortOrder",r))],items:[{title:"放送が近い順",value:"asc"},{title:"放送が遠い順",value:"desc"}],"item-title":"title","item-value":"value",class:"reservation-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue"])),e.showMoreButton?(a(),M(O,{key:1,variant:"text",class:"reservation-list__more",onClick:s[3]||(s[3]=r=>e.$emit("more"))},{default:U(()=>[s[7]||(s[7]=t("span",{class:"text-primary"},"もっと見る",-1)),c(i,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1,__:[7]})):m("",!0)])])),t("div",{class:B(["reservation-list__grid",{"reservation-list__grid--loading":e.isLoading,"reservation-list__grid--empty":u.value===0&&e.showEmptyMessage}])},[t("div",{class:B(["reservation-list__empty",{"reservation-list__empty--show":u.value===0&&e.showEmptyMessage&&!e.isLoading}])},[t("div",Ve,[c(i,{class:"reservation-list__empty-icon",icon:e.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),t("h2",{innerHTML:e.emptyMessage},null,8,Me),e.emptySubMessage?(a(),d("div",{key:0,class:"reservation-list__empty-submessage",innerHTML:e.emptySubMessage},null,8,Be)):m("",!0)])],2),t("div",$e,[(a(!0),d(P,null,F(v.value,r=>(a(),M(he,{key:r.id,reservation:r,onDeleted:k,onClick:S},null,8,["reservation"]))),128))])],2),!e.hidePagination&&u.value>0?(a(),d("div",Ce,[c(J,{modelValue:h.value,"onUpdate:modelValue":[s[4]||(s[4]=r=>h.value=r),s[5]||(s[5]=r=>e.$emit("update:page",r))],"active-color":"primary",density:"comfortable",length:Math.ceil(u.value/30),"total-visible":_(b).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):m("",!0),c(A,{modelValue:g.value,"onUpdate:modelValue":s[6]||(s[6]=r=>g.value=r),reservation:f.value,onDeleted:k,onUpdated:w},null,8,["modelValue","reservation"])],2)}}}),He=E(Re,[["__scopeId","data-v-5ffe4570"]]);export{He as R};
