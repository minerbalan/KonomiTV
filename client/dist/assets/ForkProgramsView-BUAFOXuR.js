import{d as q,q as f,s as h,c as g,n as k,e as v,b as m,w as E,a as _,r as S,t as b,F as M,l as H,k as C,h as F,V as L,g as U,B as I,U as O,C as P,o as u,R,_ as $,D as n,E as G,x as T,y as N,A as z}from"./index-DZz9w_II.js";import{V as D,B as W}from"./VPagination-e4iN_ZmG.js";import{H as A,N as J}from"./Navigation-DkhgwQcc.js";import{S as K}from"./SPHeaderBar-DYzCy6fP.js";import{F as X,R as Y}from"./RecordedProgram-DxsYYv3j.js";import{V as Z}from"./VSelect-Bevu_OUR.js";import"./ssrBoot-DN1y3lO5.js";import"./VDialog-CFImOV-R.js";import"./VChip-CB2klTWl.js";import"./VTextField-CDdIGdCr.js";import"./VAvatar-DxNGfUhM.js";import"./VCard-C-3hbVrn.js";import"./Videos-DSkRL_ee.js";const x={key:0,class:"recorded-program-list__header"},Q={class:"recorded-program-list__title"},ee={class:"recorded-program-list__title-text"},te={key:1,class:"recorded-program-list__title-count"},re={key:1,class:"my-2"},ae={class:"recorded-program-list__empty-content"},oe=["innerHTML"],se=["innerHTML"],ie={class:"recorded-program-list__grid-content"},le={key:2,class:"recorded-program-list__pagination"},de=q({__name:"ForkRecordedProgramList",props:{title:{},programs:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画番組が見つかりませんでした。"},emptySubMessage:{default:'サーバー設定で録画フォルダのパスを<br class="d-sm-none">正しく設定できているか確認してください。'},isLoading:{type:Boolean,default:!1},isSearching:{type:Boolean,default:!1},forMylist:{type:Boolean,default:!1},forWatchedHistory:{type:Boolean,default:!1},showCustomChoice:{type:Boolean},customSearch:{default:()=>({})}},emits:["update:page","update:sortOrder","update:customSearch","more"],setup(B,{emit:o}){P();const t=B,l=o,s=f(t.page),d=f(t.sortOrder),c=f({...t.customSearch}),y=f([...t.programs]),p=f(t.total);h(()=>t.page,e=>{s.value=e}),h(()=>t.sortOrder,e=>{d.value=e}),h(()=>t.programs,e=>{y.value=[...e]}),h(()=>t.total,e=>{p.value=e}),h(()=>t.customSearch,e=>{c.value={...e}},{deep:!0});const w=e=>{y.value=y.value.filter(i=>i.id!==e),p.value--},V=e=>{l("update:customSearch",c.value)};return(e,i)=>{const r=S("Icon");return u(),g("div",{class:k(["recorded-program-list",{"recorded-program-list--show-sort":!e.hideSort}])},[e.hideHeader?v("",!0):(u(),g("div",x,[m("h2",Q,[e.showBackButton?E((u(),g("div",{key:0,class:"recorded-program-list__title-back",onClick:i[0]||(i[0]=a=>e.$router.back())},[_(r,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[R]]):v("",!0),m("span",ee,b(e.title),1),e.showMoreButton?v("",!0):(u(),g("div",te,[e.isSearching?(u(),g(M,{key:0},[_(r,{icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"}),i[7]||(i[7]=m("span",null,"検索中...",-1))],64)):(u(),g(M,{key:1},[H(b(p.value)+"件",1)],64))]))]),m("div",{class:k(["recorded-program-list__actions",{"recorded-program-list__actions--mylist":e.forMylist}])},[e.hideSort?v("",!0):(u(),C(Z,{key:0,modelValue:d.value,"onUpdate:modelValue":[i[1]||(i[1]=a=>d.value=a),i[2]||(i[2]=a=>e.$emit("update:sortOrder",a))],items:e.forMylist?[{title:"追加が新しい順",value:"mylist_added_desc"},{title:"追加が古い順",value:"mylist_added_asc"},{title:"録画が新しい順",value:"recorded_desc"},{title:"録画が古い順",value:"recorded_asc"}]:[{title:"新しい順",value:"desc"},{title:"古い順",value:"asc"}],"item-title":"title","item-value":"value",class:"recorded-program-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue","items"])),e.showMoreButton?(u(),C(L,{key:1,variant:"text",class:"recorded-program-list__more",onClick:i[3]||(i[3]=a=>e.$emit("more"))},{default:F(()=>[i[8]||(i[8]=m("span",{class:"text-primary"},"もっと見る",-1)),_(r,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1,__:[8]})):v("",!0)],2)])),e.showCustomChoice?(u(),g("div",re,[_(X,{customSearch:c.value,"onUpdate:customSearch":i[4]||(i[4]=a=>c.value=a),onChange:V},null,8,["customSearch"])])):v("",!0),m("div",{class:k(["recorded-program-list__grid",{"recorded-program-list__grid--loading":e.isLoading||e.isSearching,"recorded-program-list__grid--empty":p.value===0&&e.showEmptyMessage,"recorded-program-list__grid--searching":e.isSearching}])},[m("div",{class:k(["recorded-program-list__empty",{"recorded-program-list__empty--show":p.value===0&&e.showEmptyMessage&&!e.isSearching}])},[m("div",ae,[_(r,{class:"recorded-program-list__empty-icon",icon:e.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),m("h2",{innerHTML:e.emptyMessage},null,8,oe),e.emptySubMessage?(u(),g("div",{key:0,class:"recorded-program-list__empty-submessage",innerHTML:e.emptySubMessage},null,8,se)):v("",!0)])],2),m("div",ie,[(u(!0),g(M,null,U(y.value,a=>(u(),C(Y,{key:a.id,program:a,forMylist:e.forMylist,forWatchedHistory:e.forWatchedHistory,onDeleted:w},null,8,["program","forMylist","forWatchedHistory"]))),128))])],2),!e.hidePagination&&p.value>0?(u(),g("div",le,[_(D,{modelValue:s.value,"onUpdate:modelValue":[i[5]||(i[5]=a=>s.value=a),i[6]||(i[6]=a=>e.$emit("update:page",a))],"active-color":"primary",density:"comfortable",length:Math.ceil(p.value/30),"total-visible":I(O).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):v("",!0)],2)}}}),ne=$(de,[["__scopeId","data-v-bdef4fe6"]]);class ue{static async fetchVideos(o="desc",t=1,l=null,s=null){const d=await n.get("/videos",{params:{order:o,page:t,ids:l,...(s==null?void 0:s.major_genres)&&{major_genres:s.major_genres},...(s==null?void 0:s.from_date)&&{from_date:s.from_date},...(s==null?void 0:s.to_date)&&{to_date:s.to_date}},paramsSerializer:{indexes:null}});return d.type==="error"?(n.showGenericError(d,"録画番組一覧を取得できませんでした。"),null):d.data}static async searchVideos(o,t="desc",l=1){const s=await n.get("/videos/search",{params:{query:o,order:t,page:l}});return s.type==="error"?(n.showGenericError(s,"録画番組の検索に失敗しました。"),null):s.data}static async fetchVideo(o){const t=await n.get(`/videos/${o}`);return t.type==="error"?(n.showGenericError(t,"録画番組情報を取得できませんでした。"),null):t.data}static async fetchVideoJikkyoComments(o){const t=await n.get(`/videos/${o}/jikkyo`);return t.type==="error"?(n.showGenericError(t,"過去ログコメントを取得できませんでした。"),{is_success:!1,comments:[],detail:"過去ログコメントを取得できませんでした。"}):(t.data.comments=t.data.comments.filter(l=>G.isMutedComment(l.text,l.author,l.color,l.type,l.size)===!1),t.data)}static async reanalyzeVideo(o){const t=await n.post(`/videos/${o}/reanalyze`,void 0,{timeout:6e5});if(t.type==="error"){switch(t.data.detail){default:n.showGenericError(t,"メタデータの再解析に失敗しました。");break}return!1}return!0}static async regenerateThumbnail(o,t=!1){const l=await n.post(`/videos/${o}/thumbnail/regenerate`,void 0,{params:{skip_tile_if_exists:t?"true":"false"},timeout:18e5});if(l.type==="error"){switch(l.data.detail){default:n.showGenericError(l,"サムネイルの再作成に失敗しました。");break}return!1}return!0}static async deleteVideo(o){const t=await n.delete(`/videos/${o}`);if(t.type==="error"){switch(t.data.detail){default:n.showGenericError(t,"録画ファイルの削除に失敗しました。");break}return!1}return!0}}const pe={class:"route-container"},me={class:"recorded-programs-container-wrapper"},ce={class:"recorded-programs-container"},ge=q({__name:"ForkProgramsView",setup(B){const o=z(),t=P(),l=f([]),s=f(0),d=f(!0),c=f(1),y=f("desc"),p=f({}),w=async()=>{const r=await ue.fetchVideos(y.value,c.value,null,p.value);r&&(l.value=r.recorded_programs,s.value=r.total),d.value=!1},V=async r=>{c.value=r,d.value=!0,await t.replace({query:{...o.query,page:r.toString()}})},e=async r=>{y.value=r,c.value=1,d.value=!0,await t.replace({query:{...o.query,order:r,page:"1"}})},i=async r=>{p.value=r,c.value=1,d.value=!0;const a={...o.query,page:"1"};r.major_genres?a.major_genres=r.major_genres:delete a.major_genres,r.from_date?a.from_date=r.from_date:delete a.from_date,r.to_date?a.to_date=r.to_date:delete a.to_date,await t.replace({query:a})};return h(()=>o.query,async r=>{r.page&&(c.value=parseInt(r.page)),r.order&&(y.value=r.order);const a={};r.major_genres&&(a.major_genres=r.major_genres),r.from_date&&(a.from_date=r.from_date),r.to_date&&(a.to_date=r.to_date),p.value=a,await w()},{deep:!0}),T(async()=>{await N().fetchUser(),o.query.page&&(c.value=parseInt(o.query.page)),o.query.order&&(y.value=o.query.order);const a={};o.query.major_genres&&(a.major_genres=o.query.major_genres),o.query.from_date&&(a.from_date=o.query.from_date),o.query.to_date&&(a.to_date=o.query.to_date),p.value=a,await w()}),(r,a)=>(u(),g("div",pe,[_(A),m("main",null,[_(J),m("div",me,[_(K),m("div",ce,[_(W,{crumbs:[{name:"ホーム",path:"/"},{name:"ビデオをみる",path:"/videos/"},{name:"録画番組一覧（Fork版）",path:"/fork/videos/programs",disabled:!0}]}),_(ne,{title:"録画番組一覧（Fork版）",programs:l.value,total:s.value,page:c.value,sortOrder:y.value,isLoading:d.value,showBackButton:!0,showEmptyMessage:!d.value,showCustomChoice:!0,customSearch:p.value,"onUpdate:page":V,"onUpdate:sortOrder":a[0]||(a[0]=j=>e(j)),"onUpdate:customSearch":i},null,8,["programs","total","page","sortOrder","isLoading","showEmptyMessage","customSearch"])])])])]))}}),Pe=$(ge,[["__scopeId","data-v-7447b968"]]);export{Pe as default};
