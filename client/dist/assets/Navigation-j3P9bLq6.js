import{d as R,q as E,x as D,s as L,E as b,A as q,c as C,w as g,a as o,e as z,b as l,k,h as _,aw as H,r as S,v as U,B as G,V as w,C as A,l as K,o as d,R as m,_ as B,H as M,J as j,dQ as F,a5 as J,N as Q,G as x,c_ as X,a7 as O,aa as Y,T as Z,dR as tt,cX as et,c$ as nt,K as at,a2 as st,ab as it,dz as ot,ac as rt,dS as lt,ad as vt,ag as ut,d0 as ct,ai as _t,aj as dt,dT as ht,n as h,am as N,cI as ft,U as W,m as pt,j as gt,t as mt}from"./index-jeTfvv1y.js";import{V as T,_ as kt,u as yt}from"./ssrBoot-BzTsQDNj.js";function bt(t,e,n,c){function i(a){return a instanceof n?a:new n(function(r){r(a)})}return new(n||(n=Promise))(function(a,r){function v(f){try{s(c.next(f))}catch(u){r(u)}}function y(f){try{s(c.throw(f))}catch(u){r(u)}}function s(f){f.done?a(f.value):i(f.value).then(v,y)}s((c=c.apply(t,[])).next())})}function wt(t,e){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},c,i,a,r;return r={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(r[Symbol.iterator]=function(){return this}),r;function v(s){return function(f){return y([s,f])}}function y(s){if(c)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(n=0)),n;)try{if(c=1,i&&(a=s[0]&2?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[s[0]&2,a.value]),s[0]){case 0:case 1:a=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(a=n.trys,!(a=a.length>0&&a[a.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!a||s[1]>a[0]&&s[1]<a[3])){n.label=s[1];break}if(s[0]===6&&n.label<a[1]){n.label=a[1],a=s;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(s);break}a[2]&&n.ops.pop(),n.trys.pop();continue}s=e.call(t,n)}catch(f){s=[6,f],i=0}finally{c=a=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}var St=function(){function t(){var e=this;this.event=null,this.callbacks=[],this.install=function(){return bt(e,void 0,void 0,function(){var n=this;return wt(this,function(c){switch(c.label){case 0:return this.event?(this.event.prompt(),[4,this.event.userChoice.then(function(i){var a=i.outcome;return n.updateEvent(null),a==="accepted"})]):[3,2];case 1:return[2,c.sent()];case 2:throw new Error("Not allowed to prompt.")}})})},!(typeof window>"u")&&(window.addEventListener("beforeinstallprompt",function(n){n.preventDefault(),e.updateEvent(n)}),window.addEventListener("appinstalled",function(){e.updateEvent(null)}))}return t.prototype.getEvent=function(){return this.event},t.prototype.canInstall=function(){return this.event!==null},t.prototype.updateEvent=function(e){var n=this;e!==this.event&&(this.event=e,this.callbacks.forEach(function(c){return c(n.canInstall())}))},t.prototype.addListener=function(e){e(this.canInstall()),this.callbacks.push(e)},t.prototype.removeListener=function(e){this.callbacks=this.callbacks.filter(function(n){return e!==n})},t}(),P=new St;const xt={class:"header"},Ct={key:0,class:"search-box"},$t=["placeholder"],Wt=R({__name:"HeaderBar",setup(t){const e=E(!1),n=E(""),c=A(),i=q(),a=()=>{i.path.endsWith("/search")&&i.query.query&&(n.value=decodeURIComponent(i.query.query))};D(()=>{P.addListener(u=>{e.value=u}),a()}),L(()=>i.fullPath,a);const r=b(()=>i.path.startsWith("/videos")||i.path.startsWith("/mylist")||i.path.startsWith("/watched-history")?"録画番組を検索...":"放送予定の番組を検索..."),v=()=>i.path.startsWith("/videos")||i.path.startsWith("/mylist")||i.path.startsWith("/watched-history")?"/videos/search":"/tv/search",y=u=>{u.key==="Enter"&&!u.isComposing&&s()},s=()=>{if(n.value.trim()){const u=v();c.push(`${u}?query=${encodeURIComponent(n.value.trim())}`)}},f=b(()=>{const u=i.path;return!u.startsWith("/captures")&&!u.startsWith("/settings")&&!u.startsWith("/login")&&!u.startsWith("/register")});return(u,p)=>{const $=S("router-link"),V=S("Icon");return d(),C("header",xt,[g((d(),k($,{class:"konomitv-logo ml-3 ml-md-6",to:"/tv/"},{default:_(()=>p[2]||(p[2]=[l("img",{class:"konomitv-logo__image",src:kt,height:"21"},null,-1)])),_:1,__:[2]})),[[m]]),o(T),f.value?(d(),C("div",Ct,[g(l("input",{class:"search-input",type:"search",enterkeyhint:"search",placeholder:r.value,"onUpdate:modelValue":p[0]||(p[0]=I=>n.value=I),onKeydown:y},null,40,$t),[[H,n.value]]),o(V,{class:"search-input__icon",icon:"fluent:search-20-filled",height:"24px",onClick:s})])):z("",!0),g(o(w,{variant:"flat",class:"pwa-install-button",onClick:p[1]||(p[1]=I=>G(P).install())},{default:_(()=>[o(V,{icon:"material-symbols:install-desktop-rounded",height:"20px",class:"mr-1"}),p[3]||(p[3]=K(" アプリとしてインストール ",-1))]),_:1,__:[3]},512),[[U,e.value]]),p[4]||(p[4]=l("div",{class:"mr-3 mr-md-6"},null,-1))])}}}),At=B(Wt,[["__scopeId","data-v-c7bd3898"]]),Bt=j({baseColor:String,bgColor:String,color:String,grow:Boolean,mode:{type:String,validator:t=>!t||["horizontal","shift"].includes(t)},height:{type:[Number,String],default:56},active:{type:Boolean,default:!0},...dt(),..._t(),...ct(),...ut(),...vt(),...lt({name:"bottom-navigation"}),...rt({tag:"header"}),...ot({selectedClass:"v-btn--selected"}),...it()},"VBottomNavigation"),Vt=M()({name:"VBottomNavigation",props:Bt(),emits:{"update:active":t=>!0,"update:modelValue":t=>!0},setup(t,e){let{slots:n}=e;const{themeClasses:c}=F(),{borderClasses:i}=J(t),{backgroundColorClasses:a,backgroundColorStyles:r}=Q(x(t,"bgColor")),{densityClasses:v}=X(t),{elevationClasses:y}=O(t),{roundedClasses:s}=Y(t),{ssrBootStyles:f}=yt(),u=b(()=>Number(t.height)-(t.density==="comfortable"?8:0)-(t.density==="compact"?16:0)),p=Z(t,"active",t.active),{layoutItemStyles:$}=tt({id:t.name,order:b(()=>parseInt(t.order,10)),position:b(()=>"bottom"),layoutSize:b(()=>p.value?u.value:0),elementSize:u,active:p,absolute:x(t,"absolute")});return et(t,ht),nt({VBtn:{baseColor:x(t,"baseColor"),color:x(t,"color"),density:x(t,"density"),stacked:b(()=>t.mode!=="horizontal"),variant:"text"}},{scoped:!0}),at(()=>o(t.tag,{class:["v-bottom-navigation",{"v-bottom-navigation--active":p.value,"v-bottom-navigation--grow":t.grow,"v-bottom-navigation--shift":t.mode==="shift"},c.value,a.value,i.value,v.value,y.value,s.value,t.class],style:[r.value,$.value,{height:st(u.value)},f.value,t.style]},{default:()=>[n.default&&o("div",{class:"v-bottom-navigation__content"},[n.default()])]})),{}}}),It={};function Et(t,e){const n=S("Icon");return d(),k(Vt,{class:"bottom-navigation-container elevation-12",color:"primary",grow:"",active:""},{default:_(()=>[o(w,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/tv")}]),to:"/tv/"},{default:_(()=>[o(n,{icon:"fluent:tv-20-regular",width:"30px"}),e[0]||(e[0]=l("span",{class:"mt-1"},"テレビをみる",-1))]),_:1,__:[0]},8,["class"]),o(w,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/videos")}]),to:"/videos/"},{default:_(()=>[o(n,{icon:"fluent:movies-and-tv-20-regular",width:"30px"}),e[1]||(e[1]=l("span",{class:"mt-1"},"ビデオをみる",-1))]),_:1,__:[1]},8,["class"]),o(w,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/reservations")}]),to:"/reservations/"},{default:_(()=>[o(n,{icon:"fluent:timer-16-regular",width:"30px"}),e[2]||(e[2]=l("span",{class:"mt-1"},"録画予約",-1))]),_:1,__:[2]},8,["class"]),o(w,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/captures")}]),to:"/captures/"},{default:_(()=>[o(n,{icon:"fluent:image-multiple-24-regular",width:"30px"}),e[3]||(e[3]=l("span",{class:"mt-1"},"キャプチャ",-1))]),_:1,__:[3]},8,["class"]),o(w,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/mypage")}]),to:"/mypage/"},{default:_(()=>[o(n,{icon:"fluent:person-20-regular",width:"30px"}),e[4]||(e[4]=l("span",{class:"mt-1"},"マイページ",-1))]),_:1,__:[4]},8,["class"])]),_:1})}const Nt=B(It,[["render",Et],["__scopeId","data-v-fc8cf4b6"]]);class Pt{static async fetchServerVersion(e=!1){const n=await N.get("/version");return n.type==="error"?(e===!1&&N.showGenericError(n,"バージョン情報を取得できませんでした。"),null):n.data}}const Rt=ft("version",{state:()=>({server_version_info:null,last_updated_at:0}),getters:{client_version(){return W.version},server_version(){var t;return((t=this.server_version_info)==null?void 0:t.version)??null},latest_version(){var t;return((t=this.server_version_info)==null?void 0:t.latest_version)??null},is_client_develop_version(){return this.client_version.includes("-dev")},is_server_develop_version(){var t;return((t=this.server_version)==null?void 0:t.includes("-dev"))??!1},is_update_available(){return this.server_version===null||this.latest_version===null?!1:this.is_server_develop_version===!1&&this.server_version!==this.latest_version||this.is_server_develop_version===!0&&this.server_version.replace("-dev","")===this.latest_version},is_version_mismatch(){return this.server_version===null?!1:this.client_version!==this.server_version},server_environment(){var t;return((t=this.server_version_info)==null?void 0:t.environment)??null},is_linux_environment(){const t=this.server_environment;return t==="Linux"||t==="Linux-Docker"||t==="Linux-ARM"}},actions:{async fetchServerVersion(t=!1){if(this.server_version_info!==null&&t===!1)return W.time()-this.last_updated_at>60&&this.fetchServerVersion(!0),this.server_version_info;const e=await Pt.fetchServerVersion();return e===null?null:(this.server_version_info=e,this.last_updated_at=W.time(),this.server_version_info)}}}),Tt=R({name:"Navigation",components:{BottomNavigation:Nt},computed:{...pt(Rt)},async created(){await this.versionStore.fetchServerVersion()}}),Dt={class:"navigation-container elevation-8"},Lt={class:"navigation"},qt={class:"navigation-scroll"},zt={class:"navigation__link-text"};function Ht(t,e,n,c,i,a){const r=S("Icon"),v=S("router-link"),y=S("BottomNavigation"),s=gt("ftooltip");return d(),C("div",null,[l("div",Dt,[l("nav",Lt,[l("div",qt,[g((d(),k(v,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/tv")}]),"active-class":"navigation__link--active",to:"/tv/"},{default:_(()=>[o(r,{class:"navigation__link-icon",icon:"fluent:tv-20-regular",width:"26px"}),e[0]||(e[0]=l("span",{class:"navigation__link-text"},"テレビをみる",-1))]),_:1,__:[0]},8,["class"])),[[m]]),g((d(),k(v,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/fork/videos/programs")}]),"active-class":"navigation__link--active",to:"/fork/videos/programs"},{default:_(()=>[o(r,{class:"navigation__link-icon",icon:"fluent:movies-and-tv-20-regular",width:"26px"}),e[1]||(e[1]=l("span",{class:"navigation__link-text"},"ビデオ(fork)",-1))]),_:1,__:[1]},8,["class"])),[[m]]),g((d(),k(v,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/fork/videos/timetable")}]),"active-class":"navigation__link--active",to:"/fork/videos/timetable"},{default:_(()=>[o(r,{class:"navigation__link-icon",icon:"fluent:calendar-clock-20-regular",width:"26px"}),e[2]||(e[2]=l("span",{class:"navigation__link-text"},"録画番組表(fork)",-1))]),_:1,__:[2]},8,["class"])),[[m]]),g((d(),k(v,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/timetable")}]),"active-class":"navigation__link--active",to:"/timetable/"},{default:_(()=>[o(r,{class:"navigation__link-icon",icon:"fluent:calendar-ltr-20-regular",width:"26px"}),e[3]||(e[3]=l("span",{class:"navigation__link-text"},"番組表",-1))]),_:1,__:[3]},8,["class"])),[[m]]),g((d(),k(v,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/reservations")}]),"active-class":"navigation__link--active",to:"/reservations/"},{default:_(()=>[o(r,{class:"navigation__link-icon",icon:"fluent:timer-16-regular",width:"26px",style:{padding:"0.5px"}}),e[4]||(e[4]=l("span",{class:"navigation__link-text"},"録画予約",-1))]),_:1,__:[4]},8,["class"])),[[m]]),g((d(),k(v,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/captures")}]),"active-class":"navigation__link--active",to:"/captures/"},{default:_(()=>[o(r,{class:"navigation__link-icon",icon:"fluent:image-multiple-24-regular",width:"26px"}),e[5]||(e[5]=l("span",{class:"navigation__link-text"},"キャプチャ",-1))]),_:1,__:[5]},8,["class"])),[[m]]),g((d(),k(v,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/mylist")}]),"active-class":"navigation__link--active",to:"/mylist/"},{default:_(()=>[o(r,{class:"navigation__link-icon",icon:"ic:round-playlist-play",width:"26px"}),e[6]||(e[6]=l("span",{class:"navigation__link-text"},"マイリスト",-1))]),_:1,__:[6]},8,["class"])),[[m]]),g((d(),k(v,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/watched-history")}]),"active-class":"navigation__link--active",to:"/watched-history/"},{default:_(()=>[o(r,{class:"navigation__link-icon",icon:"fluent:history-20-regular",width:"26px"}),e[7]||(e[7]=l("span",{class:"navigation__link-text"},"視聴履歴",-1))]),_:1,__:[7]},8,["class"])),[[m]]),g((d(),k(v,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/videos")}]),"active-class":"navigation__link--active",to:"/videos/"},{default:_(()=>[o(r,{class:"navigation__link-icon",icon:"fluent:movies-and-tv-20-regular",width:"26px"}),e[8]||(e[8]=l("span",{class:"navigation__link-text"},"ビデオをみる(オリジナル)",-1))]),_:1,__:[8]},8,["class"])),[[m]]),o(T),g((d(),k(v,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/settings")}]),"active-class":"navigation__link--active",to:"/settings/"},{default:_(()=>[o(r,{class:"navigation__link-icon",icon:"fluent:settings-20-regular",width:"26px"}),e[9]||(e[9]=l("span",{class:"navigation__link-text"},"設定",-1))]),_:1,__:[9]},8,["class"])),[[m]]),g((d(),C("a",{class:h(["navigation__link",{"navigation__link--develop-version":t.versionStore.is_client_develop_version,"navigation__link--highlight":t.versionStore.is_update_available}]),"active-class":"navigation__link--active",href:"https://github.com/tsukumijima/KonomiTV",target:"_blank"},[o(r,{class:"navigation__link-icon",icon:"fluent:info-16-regular",width:"26px"}),l("span",zt,"version "+mt(t.versionStore.client_version),1)],2)),[[m],[s,t.versionStore.is_update_available?`アップデートがあります (version ${t.versionStore.latest_version})`:"",void 0,{top:!0}]])])])]),o(y)])}const Kt=B(Tt,[["render",Ht],["__scopeId","data-v-4da93f41"]]);export{At as H,Kt as N,Pt as V,Rt as u};
